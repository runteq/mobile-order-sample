<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RUNTEQカフェ</title>
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= stylesheet_link_tag "tailwind", "data-turbo-track": "reload" %>
    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>

    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script>
      window.LIFF_ID = "<%= ENV['LIFF_ID'] %>";
    </script>
  </head>

  <body class="bg-gray-50 min-h-screen" data-controller="liff">
    <div id="liff-loading" class="fixed inset-0 bg-white flex items-center justify-center z-50" data-liff-target="loading">
      <div class="text-center">
        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-green-500 mx-auto"></div>
        <p class="mt-4 text-gray-600">読み込み中...</p>
      </div>
    </div>

    <div id="liff-error" class="hidden fixed inset-0 bg-white flex items-center justify-center z-50" data-liff-target="error">
      <div class="text-center p-8">
        <svg class="w-16 h-16 text-red-500 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
        </svg>
        <h2 class="mt-4 text-xl font-bold text-gray-800">LINEアプリが必要です</h2>
        <p class="mt-2 text-gray-600">LINEアプリからこのページを開いてください。</p>
      </div>
    </div>

    <div id="liff-content" class="hidden" data-liff-target="content">
      <header class="bg-green-500 text-white sticky top-0 z-40">
        <div class="flex items-center justify-between px-4 py-3">
          <h1 class="text-lg font-bold">RUNTEQカフェ</h1>
          <%= link_to liff_cart_path, class: "relative p-2" do %>
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path>
            </svg>
            <div id="cart-badge-container" class="absolute -top-1 -right-1">
              <% if cart_count > 0 %>
                <span id="cart-badge" class="bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">
                  <%= cart_count %>
                </span>
              <% end %>
            </div>
          <% end %>
        </div>
      </header>

      <main class="pb-20">
        <% if flash[:alert] %>
          <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 mx-4 mt-4 rounded">
            <%= flash[:alert] %>
          </div>
        <% end %>

        <% if flash[:notice] %>
          <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 mx-4 mt-4 rounded">
            <%= flash[:notice] %>
          </div>
        <% end %>

        <%= yield %>
      </main>

      <footer class="fixed bottom-0 left-0 right-0 bg-gray-100 border-t border-gray-200 p-2 text-center text-xs text-gray-500">
        これはデモ注文です。実際の決済・配達は行われません。
      </footer>

      <div id="toast-container" class="fixed top-20 left-1/2 -translate-x-1/2 z-50 flex flex-col gap-2"></div>
    </div>
  </body>
</html>
